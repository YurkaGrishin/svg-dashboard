<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>SVG с квадратами из таблицы</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    text {
      font-size: 10px;
      text-anchor: middle;
      dominant-baseline: central;
    }
  </style>
</head>
<body>
  <h1>Карта квадратов</h1>

  <svg width="760" height="180" xmlns="http://www.w3.org/2000/svg" id="main-svg">
    <g id="grid"></g>
  </svg>

  <script>
    // Генерация 43 квадратов в 3 ряда
    const svgNS = "http://www.w3.org/2000/svg";
    const grid = document.getElementById("grid");

    for (let n = 1; n <= 43; n++) {
      const row = Math.floor((n - 1) / 15);
      const col = (row < 2) ? (n - 1) % 15 : (n - 31);
      const x = 10 + col * 50;
      const y = 10 + row * 60;

      const rect = document.createElementNS(svgNS, "rect");
      rect.setAttribute("id", `square_${n}`);
      rect.setAttribute("x", x);
      rect.setAttribute("y", y);
      rect.setAttribute("width", 40);
      rect.setAttribute("height", 40);
      rect.setAttribute("fill", "white");
      rect.setAttribute("stroke", "black");
      rect.setAttribute("stroke-width", "2");

      const label = document.createElementNS(svgNS, "text");
      label.setAttribute("x", x + 20);
      label.setAttribute("y", y + 20);
      label.textContent = n;

      grid.appendChild(rect);
      grid.appendChild(label);
    }

    async function updateSquares() {
      const url = 'https://script.google.com/macros/s/AKfycbxUkvDo_qnz6Ucm-L146Vg2rD-z-g9tSppLjuWp145n-meNIEG49VQ616l8CFtWRNiI/exec';
      try {
        const response = await fetch(url);
        const data = await response.json();

        for (let n = 1; n <= 43; n++) {
          const id = `square_${n}`;
          const square = document.getElementById(id);
          if (!square) continue;

          const team1 = data[`square_${n}`];                  // первая команда (true/false)
          const team2 = data[`square_${n}_team2`];            // вторая команда (true/false)
          const only0_1 = data[`square_${n}_only0`] === true; // первая только 0
          const only0_2 = data[`square_${n}_team2_only0`] === true; // вторая только 0

          let fill = "white";

          if (team1 && team2) {
            fill = "gold";        // обе команды попали
          } else if (team1) {
            fill = "green";       // только первая
          } else if (team2) {
            fill = "orange";      // только вторая
          } else if (only0_1 && only0_2) {
            fill = "gray";        // обе команды поставили только 0
          }

          square.setAttribute("fill", fill);
        }

      } catch (err) {
        console.error("Ошибка при обновлении:", err);
      }
    }

    updateSquares();
    setInterval(updateSquares, 10000);
  </script>
</body>
</html>
